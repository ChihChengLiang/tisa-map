
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>L.Geocoder.OpenStreetMap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
    <![endif]-->
    
    <style type="text/css">
      html, body { height: 100% }
        body {
            padding: 0;
            margin: 0;
        }
      #map { width: 100%;height: 100%;  }

    </style>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-38980669-2', 'lijung.com');
        ga('send', 'pageview');
   </script>
    <link href="./src/css/l.geosearch.css" rel="stylesheet" />
    
</head>
<body>

    <div id="map" >
    </div> <!-- /container -->

    <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-1.8.3.min.js"  type="text/javascript"></script>
    <script src="./src/js/l.control.geosearch.js"></script>
    <script src="./src/js/l.geosearch.provider.openstreetmap.js"></script>

    <script type="text/javascript">
    var geocoder;
    var field = new Field();

    function startLocate() {
        if (navigator.geolocation) {
        
            navigator.geolocation.getCurrentPosition(function(option) {
                field.setValue(option.coords.latitude, option.coords.longitude)
            });

        } else {

            alert("Geolocation is not supported by this browser.");

        }
    }

    function createMap (setplace) {
        var map = L.map('map').setView(setplace, 13);

        L.tileLayer('http://{s}.tile.cloudmade.com/f59941c17eda4947ae395e907fe531a3/997/256/{z}/{x}/{y}.png', {
        maxZoom: 18,
        }).addTo(map);

        L.marker(setplace).addTo(map)
        .bindPopup("<b>I found you :))</b>").openPopup();

        new L.Control.GeoSearch({
            provider: new L.GeoSearch.Provider.OpenStreetMap()
        }).addTo(map);
    }

    function Field(){
        var latitude 
        var longitude 
       
        this.getValue = function(){
            console.log(latitude)
            console.log(longitude)
            return [latitude, longitude];
        };
       
        this.setValue = function(lat_val, long_val){
            latitude = lat_val;
            longitude = long_val;
            createMap (this.getValue())
        };
    }

    startLocate()

    </script>
    
</body>
</html>
